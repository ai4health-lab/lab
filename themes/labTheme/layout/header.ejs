<header class="site-header">
    <!-- 实验室名称 -->
    <div class="lab-name">
        <h1>数基生命与智能健康实验室</h1>
        <h2>Digital Life and Intelligent Health Laboratory</h2>
    </div>

    <!-- Banner 图片 -->
    <div class="banner">
        <img src="<%= theme.banner_url %>" alt="实验室Banner">
    </div>

    <!-- 导航栏和语言切换器容器 -->
    <div class="nav-container">
        <!-- 导航栏 -->
        <nav class="nav-bar">
            <ul>
                <!-- 获取当前语言 -->
                <% var lang = currentLang() || config.language || 'zh'; %>
                <!-- 解析每个菜单项 -->
                <% var menuI18n = {
                    home: __('menu.home'),
                    members: __('menu.members'),
                    research: __('menu.research'),
                    publications: __('menu.publications'),
                    tools: __('menu.tools')
                }; %>

                <!-- 菜单链接的对应地址 -->
                <% var menuLinks = {
                    home: `/${lang}/`,
                    members: `/${lang}/members/`,
                    research: `/${lang}/research/`,
                    publications: `/${lang}/publications/`,
                    tools: `/${lang}/tools/`
                }; %>

                <% Object.keys(menuLinks).forEach(function(key) { %>
                    <li>
                        <a href="<%= menuLinks[key] %>"
                           class="<%= '/' + page.path === (menuLinks[key]) ? 'active' : '' %>">
                            <%= menuI18n[key] || key %> <!-- 动态获取当前语言菜单名 -->
                        </a>
                    </li>
                <% }); %>

            </ul>
            <!-- 语言切换滑动栏 -->
            <div class="language-switcher">
                <div class="switch">
                    <div class="slider" data-lang="zh" onclick="switchLanguage('zh')">中文</div>
                    <div class="slider" data-lang="en" onclick="switchLanguage('en')">English</div>
                </div>
            </div>
        </nav>
    </div>

    <script>
        // 获取当前语言
        function currentLang() {
            var lang = document.cookie.replace(/(?:(?:^|.*;\s*)lang\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '<%= config.language || "zh" %>';
            if (!lang) {
                lang = '<%= config.language || "zh" %>'; // 从 config.yml 中获取默认语言
                document.cookie = "lang=" + lang + "; path=/";
            }
            return lang;
        }

        // 切换语言，并根据当前语言更新页面的路径
        function switchLanguage(lang) {
            var currentPath = window.location.pathname;
            var newPath = currentPath.replace(/^\/(en|zh)/, ''); // 移除当前的语言前缀

            if (lang === 'zh') {
                newPath = '/zh' + newPath; // 重新添加语言前缀
            } else {
                newPath = '/en' + newPath;
            }

            document.cookie = "lang=" + lang + "; path=/"; // 存储新的语言设置

            // 检查是否需要重定向到根路径
            if (newPath==='/') {
                console.log('Redirecting to /');
                window.location.href = `/${lang}/`; // 跳转到首页
            } else {
                console.log('Redirecting to:', newPath);
                window.location.href = newPath; // 跳转到新的路径
            }
        }

        // 页面加载后设置语言切换器的样式以及重定向/zh/和/en/到/
        document.addEventListener('DOMContentLoaded', function () {
            var lang = currentLang();
            document.querySelectorAll('.switch .slider').forEach(function (slider) {
                if (slider.getAttribute('data-lang') === lang) {
                    slider.classList.add('active'); // 给选中的语言加上 active 样式
                } else {
                    slider.classList.remove('active');
                }
            });
        });
    </script>
</header>
